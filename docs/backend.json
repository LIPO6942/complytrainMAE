{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the ComplyTrain platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (e.g., admin, trainer, learner, BU, auditor)."
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "departmentId": {
          "type": "string",
          "description": "Reference to Department. (Relationship: Department 1:N User)"
        },
        "lastSignInTime": {
          "type": "string",
          "format": "date-time",
          "description": "The last time the user signed in."
        }
      },
      "required": ["id", "email", "role"]
    },
    "Department": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Department",
      "type": "object",
      "description": "Represents a department or business unit within the organization.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Department entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the department or business unit."
        },
        "description": {
          "type": "string",
          "description": "Description of the department or business unit."
        }
      },
      "required": ["id", "name"]
    },
    "Course": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Course",
      "type": "object",
      "description": "Represents a compliance training course.",
      "properties": {
        "title": {
          "type": "string",
          "description": "The title of the course."
        },
        "category": {
          "type": "string",
          "description": "The category of the course (e.g., LCB, KYC)."
        },
        "description": {
          "type": "string",
          "description": "A brief description of the course content."
        },
        "image": {
          "type": "string",
          "description": "ID of the placeholder image for the course."
        },
        "quizId": {
          "type": "string",
          "description": "The ID of the quiz associated with this course."
        },
        "videoUrl": {
          "type": "string",
          "description": "URL of the course video content (e.g., YouTube)."
        },
        "markdownContent": {
          "type": "string",
          "description": "The course content in Markdown format."
        },
        "pdfUrl": {
          "type": "string",
          "description": "URL of the course PDF document."
        }
      },
      "required": ["title", "category", "description", "image", "quizId"]
    },
    "Quiz": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Quiz",
      "type": "object",
      "description": "Represents a quiz associated with a course.",
      "properties": {
        "title": {
          "type": "string",
          "description": "The title of the quiz."
        },
        "questions": {
          "type": "array",
          "description": "An array of questions for the quiz.",
          "items": {
            "type": "object",
            "properties": {
              "text": {
                "type": "string"
              },
              "options": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              },
              "correctAnswer": {
                "type": "number",
                "description": "The index of the correct answer in the options array."
              }
            },
            "required": ["text", "options", "correctAnswer"]
          }
        }
      },
      "required": ["title", "questions"]
    },
    "Invitation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Invitation",
      "type": "object",
      "description": "Represents an invitation for a new user.",
      "properties": {
        "email": {
          "type": "string",
          "format": "email",
          "description": "Email of the invited user."
        },
        "role": {
          "type": "string",
          "description": "Role assigned to the invited user."
        },
        "status": {
          "type": "string",
          "enum": ["pending", "completed"],
          "description": "Status of the invitation."
        }
      },
      "required": ["email", "role", "status"]
    }
  },
  "auth": {
    "providers": ["password", "anonymous"]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Uses path-based ownership for simplified security rules. Includes the denormalized 'departmentId' field for authorization purposes.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/departments/{departmentId}",
        "definition": {
          "entityName": "Department",
          "schema": {
            "$ref": "#/backend/entities/Department"
          },
          "description": "Stores department or business unit information.",
          "params": [
            {
              "name": "departmentId",
              "description": "The unique identifier for the department."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}",
        "definition": {
          "entityName": "Course",
          "schema": {
            "$ref": "#/backend/entities/Course"
          },
          "description": "Stores all available compliance courses.",
          "params": [
            {
              "name": "courseId",
              "description": "The unique identifier for the course."
            }
          ]
        }
      },
      {
        "path": "/courses/{courseId}/quizzes/{quizId}",
        "definition": {
          "entityName": "Quiz",
          "schema": {
            "$ref": "#/backend/entities/Quiz"
          },
          "description": "Stores quiz data for a specific course.",
          "params": [
            {
              "name": "courseId",
              "description": "The ID of the course."
            },
            {
              "name": "quizId",
              "description": "The ID of the quiz."
            }
          ]
        }
      },
      {
        "path": "/invitations/{invitationId}",
        "definition": {
          "entityName": "Invitation",
          "schema": {
            "$ref": "#/backend/entities/Invitation"
          },
          "description": "Stores user invitations. Admins can create them.",
          "params": [
            {
              "name": "invitationId",
              "description": "The unique identifier for the invitation."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support ComplyTrain's online training platform, focusing on compliance and regulation. It incorporates role-based access control (admin and user) and ensures authorization independence through denormalization. The structure segregates user data (profiles, departments) to simplify security rules and enhance scalability. Quizzes are stored as a sub-collection of courses to maintain a clear hierarchical relationship and enable efficient data retrieval for a given course. Authorization Independence is achieved by storing role information directly within the `users` document. This avoids costly and limiting `get()` operations in security rules, particularly crucial for atomic operations. The `departmentId` field in the user document is also denormalized, as is standard practice in these designs. QAPs (Rules are not Filters) are supported through structural segregation and membership models. User profiles are stored under `/users/{userId}`, allowing for secure `list` operations based on user ID. Admin roles are managed using a `role` field in the user's document. The structure employs path-based ownership for user-related data, simplifying security rules. The `invitations` collection is added to allow admins to invite new users with a specific role."
  }
}
